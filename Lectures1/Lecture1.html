<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lecture 1: Spatial Data</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ignacio Sarmiento Barbieri" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/js-cookie/js.cookie.js"></script>
    <script src="libs/peerjs/peerjs.min.js"></script>
    <script src="libs/tiny.toast/toast.min.js"></script>
    <link href="libs/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="libs/xaringanExtra_fit-screen/fit-screen.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <script src="libs/fabric/fabric.min.js"></script>
    <link href="libs/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/leaflet/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet/leaflet.js"></script>
    <link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding/leaflet.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">









class: center, middle


#  Datos Espaciales


### Ignacio Sarmiento-Barbieri

---
# Motivación

&lt;img src="figures/blumenstock_fig2.png" width="700" style="display: block; margin: auto;" /&gt;

---
# Tipos de Datos Espaciales

Los datos espaciales vienen en muchas "formas" y "tamaños", los tipos más comunes de datos espaciales son:

- **Punto**

- **Líneas**

- **Polígonos**

- **Grillas (*o raster*)**


---
# Types of Spatial Data: Points


&lt;img src="figures/albouy_et_al_fig1.png" width="500" height="500" style="display: block; margin: auto;" /&gt;

Fuente: Albouy, Christensen &amp; Sarmiento-Barbieri (2022)




---
# Types of Spatial Data: Lines


&lt;img src="figures/safe_passage.png" width="500" style="display: block; margin: auto;" /&gt;





---
# Types of Spatial Data: Polygons


&lt;img src="figures/upz_1.png" width="700" height="450" style="display: block; margin: auto;" /&gt;
  Fuente: https://datosabiertos.bogota.gov.co/dataset/unidad-de-planeamiento-bogota-d-c



---
# Types of Spatial Data: Combination

.pull-left[
&lt;img src="figures/ZIP_A.png" width="700" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="figures/ZIP_B.png" width="700" style="display: block; margin: auto;" /&gt;
]
Fuente: Christensen,Sarmiento-Barbieri  &amp; Timmins (2020)



---
# Types of Spatial Data: Rasters


&lt;img src="figures/NewYork-1.png" width="400" style="display: block; margin: auto;" /&gt;
Fuente: https://data.cityofnewyork.us/Environment/NYCCAS-Air-Pollution-Rasters/q68s-8qxv



---
# Reading and Mapping spatial data in R
## Shapefiles

Main files

  -  `file.shp`
  -  `file.shx`
  -  `file.dbf`

Other files

  -  `file.prj`
  - `file.sbn` , `file.sbx`
  -  `file.shp.xml`
    

---
# Reading and Mapping spatial data in R
## GeoJSON




```r
{
  "type": "Feature",
  "geometry": {
    "type": "Point",
    "coordinates": [-74.066391, 4.601590]
  },
  "properties": {
    "name": "Universidad de Los Andes"
  }
}
```



---
## Reading shapefiles in R


- Basic Packages: 
  - Read and handle spatial data

```r
require("sf")
```

```
## Loading required package: sf
```

```
## Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE
```
  - Data wrangling and plotting

```r
require("tidyverse")
```
  -  File referencing in project-oriented workflows

```r
require("here")
```

```
## Loading required package: here
```

```
## here() starts at /Users/iggy/Dropbox/Teaching/2022/SpatialDataEng/Lectures/Lectures1
```
---
## Reading shapefiles in R


```r
bars&lt;-st_read(here("egba/EGBa.shp"))
```

```
## Reading layer `EGBa' from data source 
##   `/Users/iggy/Dropbox/Teaching/2022/SpatialDataEng/Lectures/Lectures1/egba/EGBa.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 515 features and 7 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -74.17607 ymin: 4.577897 xmax: -74.02929 ymax: 4.806253
## Geodetic CRS:  MAGNA-SIRGAS
```
---
## Visualizing Points

.pull-left[

```r
ggplot()+
  geom_sf(data=bars) +
  theme_bw() +
  theme(axis.title =element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size=6))
```
]

.pull-right[
![](Lecture1_files/figure-html/plot_bars-1.png)&lt;!-- --&gt;
]

---
## Reading shapefiles in R


```r
colegios&lt;-st_read(here("colegios_bogota.json"))
```

```
## Reading layer `Colegio' from data source 
##   `/Users/iggy/Dropbox/Teaching/2022/SpatialDataEng/Lectures/Lectures1/colegios_bogota.json' 
##   using driver `GeoJSON'
## Simple feature collection with 2405 features and 35 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -8278115 ymin: 433393.9 xmax: -8239442 ymax: 537967
## Projected CRS: WGS 84 / Pseudo-Mercator
```
---
## Visualizing Points

.pull-left[

```r
ggplot()+
  geom_sf(data=colegios) +
  theme_bw() +
  theme(axis.title =element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size=6))
```
]

.pull-right[
![](Lecture1_files/figure-html/plot_col_out-1.png)&lt;!-- --&gt;
]

---
## Visualizing Lines

.pull-left[

```r
ciclovias&lt;-read_sf(here("Ciclovia/Ciclovia.shp"))

ggplot()+
  geom_sf(data=ciclovias) +
  theme_bw() +
  theme(axis.title =element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size=6))
```
]

.pull-right[
![](Lecture1_files/figure-html/plot-label-out1-1.png)&lt;!-- --&gt;
]


---
## Visualizing Polygons

.pull-left[

```r
upla&lt;-read_sf(here("upla/UPla.shp"))

ggplot()+
  geom_sf(data=upla, aes(fill = UPlArea)) +
  theme_bw() +
  theme(axis.title =element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size=6))
```
]

.pull-right[
![](Lecture1_files/figure-html/plot-label-out2-1.png)&lt;!-- --&gt;
]

---
## Interactive Viz

.pull-left[

```r
require("leaflet")
m &lt;- leaflet() %&gt;% 
  setView(lng = -74.066391, lat = 4.601590, zoom = 12)
```
]

.pull-right[

```r
m %&gt;% addTiles()
```

<div id="htmlwidget-d4fa9631bae8f389de2d" style="width:504px;height:504px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d4fa9631bae8f389de2d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[4.60159,-74.066391],12,[]],"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]}]},"evals":[],"jsHooks":[]}</script>
]

---
## Interactive Viz


```r
m %&gt;% addProviderTiles(providers$Stamen.Toner)


m %&gt;% addProviderTiles(providers$OpenTopoMap)

#Add Polygons
leaflet(upla) %&gt;% 
   addTiles() %&gt;% 
  addPolygons()

#Add labels
leaflet(upla) %&gt;% 
   addTiles() %&gt;% 
  addPolygons(label = upla$UPlNombre)
```

For more options http://leaflet-extras.github.io/leaflet-providers/preview/index.html

---
## Open Street Data


```r
require("osmdata")
```

```
## Loading required package: osmdata
```

```
## Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright
```

```r
# get avaliables values for amenity
available_tags("amenity")
```

```
##   [1] "animal_boarding"        "animal_breeding"        "animal_shelter"        
##   [4] "arts_centre"            "atm"                    "baby_hatch"            
##   [7] "baking_oven"            "bank"                   "bar"                   
##  [10] "bbq"                    "bench"                  "bicycle_parking"       
##  [13] "bicycle_rental"         "bicycle_repair_station" "biergarten"            
##  [16] "boat_rental"            "boat_sharing"           "brothel"               
##  [19] "bureau_de_change"       "bus_station"            "cafe"                  
##  [22] "car_rental"             "car_sharing"            "car_wash"              
##  [25] "casino"                 "charging_station"       "childcare"             
##  [28] "cinema"                 "clinic"                 "clock"                 
##  [31] "college"                "community_centre"       "conference_centre"     
##  [34] "courthouse"             "crematorium"            "dentist"               
##  [37] "dive_centre"            "doctors"                "dog_toilet"            
##  [40] "drinking_water"         "driving_school"         "embassy"               
##  [43] "events_venue"           "fast_food"              "ferry_terminal"        
##  [46] "fire_station"           "food_court"             "fountain"              
##  [49] "fuel"                   "funeral_hall"           "gambling"              
##  [52] "give_box"               "grave_yard"             "grit_bin"              
##  [55] "gym"                    "hospital"               "hunting_stand"         
##  [58] "ice_cream"              "internet_cafe"          "kindergarten"          
##  [61] "kitchen"                "kneipp_water_cure"      "language_school"       
##  [64] "library"                "lounger"                "love_hotel"            
##  [67] "marketplace"            "monastery"              "motorcycle_parking"    
##  [70] "music_school"           "nightclub"              "nursing_home"          
##  [73] "parcel_locker"          "parking"                "parking_entrance"      
##  [76] "parking_space"          "pharmacy"               "photo_booth"           
##  [79] "place_of_mourning"      "place_of_worship"       "planetarium"           
##  [82] "police"                 "post_box"               "post_depot"            
##  [85] "post_office"            "prison"                 "pub"                   
##  [88] "public_bath"            "public_bookcase"        "public_building"       
##  [91] "ranger_station"         "recycling"              "refugee_site"          
##  [94] "restaurant"             "sanitary_dump_station"  "school"                
##  [97] "shelter"                "shower"                 "social_centre"         
## [100] "social_facility"        "stripclub"              "studio"                
## [103] "swingerclub"            "taxi"                   "telephone"             
## [106] "theatre"                "toilets"                "townhall"              
## [109] "toy_library"            "university"             "vehicle_inspection"    
## [112] "vending_machine"        "veterinary"             "waste_basket"          
## [115] "waste_disposal"         "waste_transfer_station" "water_point"           
## [118] "watering_place"
```

```r
available_tags("building")
```

```
##  [1] "apartments"                    "bakehouse"                    
##  [3] "barn"                          "barracks"                     
##  [5] "beach_hut"                     "bridge"                       
##  [7] "bungalow"                      "bunker"                       
##  [9] "cabin"                         "carport"                      
## [11] "castle"                        "cathedral"                    
## [13] "chapel"                        "church"                       
## [15] "civic"                         "college"                      
## [17] "commercial"                    "conservatory"                 
## [19] "construction"                  "container"                    
## [21] "cowshed"                       "detached"                     
## [23] "digester"                      "dormitory"                    
## [25] "entrance"                      "farm"                         
## [27] "farm_auxiliary"                "fire_station"                 
## [29] "garage"                        "garages"                      
## [31] "gatehouse"                     "ger"                          
## [33] "government"                    "grandstand"                   
## [35] "greenhouse"                    "hangar"                       
## [37] "hospital"                      "hotel"                        
## [39] "house"                         "houseboat"                    
## [41] "hut"                           "industrial"                   
## [43] "kindergarten"                  "kingdom_hall"                 
## [45] "kiosk"                         "library&amp;action=edit&amp;redlink=1"
## [47] "military"                      "monastery"                    
## [49] "mosque"                        "office"                       
## [51] "parking"                       "pavilion"                     
## [53] "presbytery"                    "public"                       
## [55] "religious"                     "residential"                  
## [57] "retail"                        "riding_hall"                  
## [59] "roof"                          "ruins"                        
## [61] "school"                        "semidetached_house"           
## [63] "service"                       "shed"                         
## [65] "shrine"                        "slurry_tank"                  
## [67] "sports_hall"                   "stable"                       
## [69] "stadium"                       "static_caravan"               
## [71] "sty"                           "supermarket"                  
## [73] "synagogue"                     "temple"                       
## [75] "tent"                          "terrace"                      
## [77] "toilets"                       "train_station"                
## [79] "transformer_tower"             "transportation"               
## [81] "tree_house"                    "university"                   
## [83] "warehouse"                     "water_tower"                  
## [85] "yes"
```

```r
available_tags("landuse")
```

```
##  [1] "allotments"              "aquaculture"            
##  [3] "basin"                   "brownfield"             
##  [5] "cemetery"                "commercial"             
##  [7] "conservation"            "construction"           
##  [9] "depot"                   "education"              
## [11] "farmland"                "farmyard"               
## [13] "flowerbed"               "forest"                 
## [15] "garages"                 "grass"                  
## [17] "greenfield"              "greenhouse_horticulture"
## [19] "industrial"              "landfill"               
## [21] "meadow"                  "military"               
## [23] "orchard"                 "plant_nursery"          
## [25] "port"                    "quarry"                 
## [27] "railway"                 "recreation_ground"      
## [29] "religious"               "reservoir"              
## [31] "residential"             "retail"                 
## [33] "salt_pond"               "village_green"          
## [35] "vineyard"                "winter_sports"
```
---
## Open Street Data


```r
# get bbox
getbb("Bogotá Colombia")
```

```
##          min       max
## x -74.223514 -74.01026
## y   4.471175   4.83317
```

```r
# get osm data
osm = opq(bbox = getbb("Bogotá Colombia")) %&gt;%
      add_osm_feature(key = "amenity", value = "bar") %&gt;%
      #add_osm_feature(key = "amenity", value = "bus_station") %&gt;%
      #add_osm_feature(key = "amenity", value = "restaurant") %&gt;%
      osmdata_sf()
osm %&gt;% class()
```

```
## [1] "list"       "osmdata"    "osmdata_sf"
```
---
## Open Street Data


```r
osm
```

```
## Object of class 'osmdata' with:
##                  $bbox : 4.4711754,-74.2235137,4.8331695,-74.0102577
##         $overpass_call : The call submitted to the overpass API
##                  $meta : metadata including timestamp and version numbers
##            $osm_points : 'sf' Simple Features Collection with 883 points
##             $osm_lines : NULL
##          $osm_polygons : 'sf' Simple Features Collection with 81 polygons
##        $osm_multilines : NULL
##     $osm_multipolygons : NULL
```
---
## Open Street Data


```r
# get sf object
amenities = osm$osm_points %&gt;% select(osm_id,amenity)
# plot data
leaflet() %&gt;% 
  addTiles() %&gt;% 
  addCircleMarkers(data=amenities , weight=1 , col="green")
```

<div id="htmlwidget-6d13bbcd71c1ca3d9f38" style="width:504px;height:504px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-6d13bbcd71c1ca3d9f38">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[4.7127148,4.6892913,4.6766117,4.6735711,4.6681176,4.6181826,4.6410766,4.6413342,4.641762,4.6415802,4.6418903,4.6417727,4.6416283,4.6414786,4.567847,4.5599221,4.5675689,4.5638043,4.6678237,4.8191459,4.7554184,4.7559219,4.6292647,4.603907,4.6703085,4.6685265,4.6753951,4.6130979,4.6688629,4.6796008,4.6461314,4.6262669,4.5541049,4.6699194,4.6735101,4.6287386,4.6311167,4.6275461,4.6341787,4.5744346,4.5745377,4.5745028,4.574591,4.7421693,4.6344137,4.607449,4.6451353,4.6037584,4.6751182,4.5946301,4.630917,4.634104,4.6376225,4.6375806,4.6464438,4.5711696,4.5841087,4.5838413,4.5835858,4.5837269,4.5838592,4.583965,4.5841079,4.5842543,4.5839456,4.5840867,4.5845348,4.5844043,4.5845207,4.584653,4.5847747,4.5844272,4.5847508,4.5840983,4.5840277,4.5729618,4.6279607,4.6007472,4.600814,4.600741,4.6006742,4.6000384,4.5831332,4.5831871,4.5831353,4.5830814,4.6316017,4.629717,4.599774,4.6331334,4.6332587,4.6331309,4.6332564,4.6328056,4.6329257,4.632928,4.6328078,4.5837224,4.6734168,4.6101433,4.6750419,4.7503135,4.6331051,4.7500457,4.7065592,4.7061662,4.5577602,4.5577606,4.557676,4.5576987,4.7556952,4.7525875,4.6275513,4.7570586,4.707477,4.674576,4.5998501,4.6733397,4.6732383,4.6735634,4.6734473,4.6735019,4.6733872,4.6734118,4.6733053,4.706671,4.707358,4.706615,4.706698,4.7067032,4.7066178,4.7065788,4.6757262,4.5800132,4.5798244,4.6340749,4.6340364,4.6332909,4.6316245,4.6315062,4.6345432,4.6341774,4.637912,4.6379066,4.6039745,4.6040452,4.6039355,4.6038649,4.6248407,4.5943518,4.5947015,4.5942521,4.6326556,4.6326721,4.6322399,4.632203,4.6320166,4.5930858,4.5930674,4.621227,4.6212632,4.6211899,4.6211568,4.7346581,4.7346453,4.7347182,4.7347284,4.5641202,4.5641294,4.5642116,4.5641976,4.5641702,4.5641909,4.6107523,4.6954319,4.5648225,4.5647731,4.564884,4.5648346,4.637564,4.6376527,4.6375367,4.6377126,4.6376313,4.6375959,4.6376801,4.6379753,4.6380608,4.6321461,4.688832,4.6886765,4.758844,4.7583612,4.7584053,4.7582516,4.7574391,4.6347021,4.6346802,4.6347714,4.6081179,4.6381249,4.6380411,4.6379842,4.6379366,4.6377832,4.6378326,4.6321644,4.6328312,4.6785023,4.6360035,4.6359186,4.6358965,4.6359814,4.6359185,4.6359093,4.6063924,4.6062114,4.6061759,4.6054916,4.6054308,4.6053963,4.6063569,4.6054572,4.5769993,4.5770879,4.5771682,4.5770595,4.5771474,4.5772019,4.5771141,4.6539616,4.6305391,4.7123591,4.5817098,4.6677533,4.6679188,4.6685669,4.667393,4.7565663,4.7560121,4.7556759,4.7578503,4.6346657,4.6346701,4.6346754,4.6346855,4.6383754,4.7582578,4.6825268,4.6825764,4.6826224,4.6826638,4.6828847,4.6829366,4.6828217,4.6827656,4.6825375,4.6824955,4.6824473,4.6823992,4.5898246,4.6334451,4.6334301,4.633405,4.6333967,4.6328508,4.6328627,4.7392961,4.6335314,4.6324919,4.6329799,4.6357051,4.6357136,4.6358987,4.6358898,4.6317478,4.63709,4.6372957,4.6372058,4.6372934,4.6364558,4.6364653,4.6365984,4.6366489,4.6028423,4.6768432,4.6279795,4.6280749,4.6278286,4.6278233,4.6379905,4.6584575,4.6586179,4.6586981,4.658789,4.6588799,4.6028439,4.6114198,4.6295632,4.6291798,4.7471239,4.7474613,4.7468763,4.7150615,4.6372859,4.6371758,4.6370572,4.5814627,4.6347881,4.5020772,4.6341134,4.7579763,4.6505027,4.6498314,4.7578473,4.757985,4.757497,4.5509293,4.6078044,4.6066869,4.6957796,4.6769269,4.6768193,4.6766709,4.6767785,4.6280014,4.640312,4.6455729,4.5116796,4.6320571,4.6689556,4.6178955,4.6188313,4.6189022,4.6189072,4.6188382,4.6188993,4.6188303,4.6189062,4.6187662,4.6187594,4.6188934,4.6187653,4.6188845,4.6188806,4.6188707,4.6187406,4.6187318,4.6187318,4.6188668,4.6188579,4.6187298,4.6188579,4.6187229,4.6187288,4.6188617,4.6188529,4.6190467,4.6413365,4.7168985,4.6401429,4.6009108,4.5970753,4.6703895,4.6692002,4.6695186,4.6113115,4.6423536,4.6422313,4.6004674,4.6698957,4.6344388,4.6218909,4.6540019,4.6004701,4.6007036,4.6006022,4.6005291,4.6296277,4.6003618,4.5980534,4.5952375,4.6595584,4.630424,4.6559061,4.6506208,4.6585874,4.6508503,4.6563282,4.5990526,4.6005729,4.600374,4.5989646,4.5988394,4.704125,4.7042181,4.7042898,4.7042905,4.704214,4.7042555,4.6333962,4.7369577,4.7225401,4.7225803,4.7226029,4.7225627,4.722596,4.7626572,4.7621147,4.7450431,4.6511633,4.6607993,4.6279637,4.6606131,4.6141733,4.7029426,4.7028581,4.7014949,4.6787535,4.5833999,4.5833923,4.5833812,4.6845423,4.6327104,4.6326954,4.6327186,4.6189769,4.6326665,4.5984792,4.5984087,4.5984156,4.5983444,4.5992727,4.5991997,4.5993126,4.5992437,4.7245815,4.632621,4.6340523,4.7193973,4.7403696,4.740264,4.7398921,4.6136284,4.7399844,4.6052784,4.5994673,4.5971157,4.6062297,4.6313517,4.6332228,4.6335444,4.608444,4.6083995,4.6083261,4.6083809,4.684774,4.6847475,4.6846701,4.6846966,4.6847562,4.6847652,4.6847459,4.6847626,4.684828,4.6848023,4.6706457,4.6687338,4.6686415,4.6687618,4.6686677,4.6688829,4.6690464,4.6690256,4.6712584,4.6713306,4.6712412,4.671169,4.666841,4.6703563,4.6723735,4.6777136,4.6753248,4.6760631,4.6697162,4.6699574,4.6905551,4.7184684,4.670429,4.6693569,4.6693046,4.6692302,4.6692872,4.6307261,4.7157898,4.6969854,4.8063927,4.8063367,4.8062122,4.8062683,4.7036771,4.7398664,4.6888846,4.6888409,4.6911193,4.6922579,4.7161215,4.7161123,4.7162033,4.7162128,4.697818,4.6968294,4.6963799,4.6984752,4.6973009,4.6980289,4.7089346,4.7064149,4.7063334,4.7063967,4.7064782,4.7313464,4.7151691,4.7141215,4.6961247,4.7046551,4.6952726,4.6890515,4.6913124,4.7647658,4.7647284,4.764724,4.7647614,4.6844883,4.7648422,4.6468714,4.6784339,4.6785066,4.678575,4.6521562,4.6496527,4.6488539,4.7337794,4.7337573,4.7337062,4.7337282,4.644723,4.6453959,4.6781442,4.6463987,4.6223136,4.62175,4.749517,4.6965609,4.6435305,4.7008821,4.702879,4.7029635,4.7007349,4.7041956,4.7041143,4.7031445,4.7027446,4.702812,4.7025766,4.7022938,4.7020773,4.7021615,4.6951496,4.6950964,4.6951643,4.6952185,4.7043777,4.7043179,4.7043629,4.7044226,4.7193511,4.6945432,4.6945748,4.6944499,4.6944183,4.7162872,4.6039572,4.6036226,4.6038214,4.7235991,4.7374113,4.6058261,4.5883215,4.672242,4.5723569,4.6131893,4.6135603,4.6128997,4.6128349,4.6180166,4.6529745,4.5794186,4.5988409,4.5937329,4.6135206,4.5419187,4.6055202,4.6055345,4.6055353,4.6055099,4.605484,4.5987431,4.5665393,4.5896297,4.5919309,4.5919881,4.5919394,4.5918822,4.6305567,4.5971946,4.5971948,4.5969308,4.5969306,4.5663575,4.5657428,4.56577,4.5658048,4.5657776,4.5895292,4.5895366,4.5894864,4.5894864,4.5850892,4.5850521,4.5849926,4.5850293,4.5843056,4.5847176,4.554714,4.6515815,4.5478505,4.5545466,4.6918276,4.6309202,4.6308741,4.630929,4.630975,4.5516178,4.6246584,4.6693546,4.6694257,4.6687857,4.6688081,4.6688383,4.668881,4.667832,4.6678791,4.6677173,4.6676703,4.6687384,4.6364211,4.6427436,4.6107918,4.6136441,4.613535,4.6134368,4.6135459,4.6504717,4.6137449,4.6138046,4.6137591,4.6136995,4.6292253,4.6292188,4.6291771,4.6291836,4.6108307,4.6157164,4.6156802,4.615939,4.6159752,4.6143656,4.6145424,4.6146176,4.6151534,4.6151199,4.6152705,4.6153246,4.6151742,4.6153513,4.6154918,4.6154167,4.6155623,4.6154656,4.6156112,4.6251777,4.6251672,4.6252643,4.6252748,4.623057,4.6209924,4.6208364,4.6215187,4.6178868,4.6176168,4.6176255,4.6189647,4.6233329,4.6195422,4.6197885,4.6200599,4.6117036,4.6232206,4.597664,4.5671059,4.567051,4.5671111,4.5671314,4.5671381,4.5960579,4.6332057,4.6415834,4.6123065,4.7533521,4.7030421,4.6917299,4.5790265,4.7156857,4.7170891,4.7123591,4.6487203,4.600071,4.6002822,4.7050997,4.7376958,4.6973601,4.6032442,4.6690054,4.6752498,4.6752498,4.6751104,4.675107,4.6684403,4.6032177,4.7496572,4.6976879,4.6141796,4.614285,4.6328427,4.6721814,4.6242226,4.6291763,4.6228568,4.6405351,4.6554552,4.6172577,4.6207204,4.627517,4.6335844,4.6334538,4.6171953,4.6177711,4.7154828,4.6967708,4.6971613,4.6561005,4.7252324,4.6141615,4.614267,4.6328558,4.6679651,4.645885,4.6461859,4.6470731,4.6169428,4.6334775,4.6335168,4.6370975,4.6678975,4.6679713,4.6678598,4.6677825,4.6234177,4.6290894,4.6067551,4.607286,4.6762478,4.624296,4.6242781,4.6241404,4.6241617,4.624159,4.6242601,4.6242904,4.6237335,4.6237131,4.6236497,4.623625,4.6236863,4.6236913,4.7225249,4.7224883,4.6308837,4.7154232,4.7154837,4.7154265,4.7153651,4.7161037,4.7161518,4.7161604,4.7161123,4.6379577,4.5986445,4.5987553,4.5987042,4.5985694,4.5985481,4.5986233,4.5870922,4.6035731,4.6448223,4.6034256,4.6140212,4.6699067,4.5998789,4.5945881,4.6778703,4.7469789,4.7471248,4.7471876,4.7472422,4.7472736,4.7473282,4.7473811,4.7472637,4.7471893,4.7473133,4.7471728,4.7470801,4.7469412,4.7468717,4.7470553,4.6857626,4.5860639,4.5798199,4.6858505,4.5521253,4.7203766,4.5413564,4.7431102,4.7427532,4.7432323,4.5634147,4.5736899,4.5777098,4.5780373,4.5662891,4.574213,4.56403,4.5641216,4.5632396,4.5555522,4.5552996,4.5729294,4.5574667,4.5710389,4.568741,4.5591598,4.564202,4.5643408,4.5641831,4.5779042,4.5820353,4.5703935,4.57096,4.5718192,4.5712743,4.5696329,4.5834226,4.5819901,4.6158113,4.7253486,4.7167753,4.6521225,4.696333,4.6670257,4.7090815],[-74.071167,-74.069395,-74.0508866,-74.0195956,-74.0128579,-74.0691435,-74.0756507,-74.0761716,-74.0758712,-74.0759087,-74.0760536,-74.076075,-74.0761072,-74.0761394,-74.1264289,-74.1239076,-74.1266113,-74.1292077,-74.0555882,-74.0319945,-74.0493342,-74.0510303,-74.065842,-74.1303793,-74.1057002,-74.0541693,-74.047949,-74.1344873,-74.0550129,-74.0475906,-74.0629004,-74.1727156,-74.140029,-74.1085605,-74.1042944,-74.0685144,-74.0644377,-74.0657739,-74.0791759,-74.1865459,-74.1864863,-74.1866211,-74.1865664,-74.0844159,-74.0772348,-74.0693673,-74.0626939,-74.0682866,-74.0214781,-74.1375914,-74.0865286,-74.079172,-74.0638386,-74.0637149,-74.163812,-74.0952929,-74.1000492,-74.1003389,-74.1000553,-74.1004198,-74.1005455,-74.1004517,-74.1005808,-74.1007366,-74.1006463,-74.100756,-74.1007189,-74.1006215,-74.10048,-74.1005915,-74.1004517,-74.1008144,-74.1001191,-74.09996,-74.0998968,-74.0914992,-74.0687754,-74.1534414,-74.1532539,-74.1532277,-74.1534152,-74.1550873,-74.1381454,-74.1380617,-74.1380282,-74.1381118,-74.064475,-74.0684077,-74.1550274,-74.1302558,-74.1302489,-74.1302121,-74.1302055,-74.1292032,-74.1291982,-74.1292526,-74.1292575,-74.0985268,-74.1480537,-74.1191758,-74.1479207,-74.0504594,-74.1795062,-74.0502702,-74.0971174,-74.0966091,-74.0989246,-74.0988589,-74.0989069,-74.0989595,-74.1031653,-74.1083738,-74.0658199,-74.0475515,-74.1245463,-74.1475328,-74.1329011,-74.1479692,-74.1481111,-74.1481344,-74.1482673,-74.1480809,-74.1482221,-74.1480138,-74.1481549,-74.1004321,-74.1005447,-74.1008826,-74.1008777,-74.100974,-74.1009765,-74.098973,-74.0970625,-74.2028095,-74.20294,-74.0786823,-74.0785414,-74.0799404,-74.0823919,-74.081923,-74.0778688,-74.0782226,-74.1541982,-74.1543484,-74.1046323,-74.1045783,-74.104434,-74.1044881,-74.1700621,-74.1392011,-74.1393839,-74.1381682,-74.0651085,-74.0651721,-74.065028,-74.0648879,-74.0649347,-74.1385445,-74.138409,-74.1427242,-74.1426911,-74.1426153,-74.1426497,-74.0889561,-74.0889292,-74.0888997,-74.0889255,-74.08306,-74.08308,-74.0830404,-74.0830223,-74.0830612,-74.0830512,-74.1323607,-74.1070307,-74.0835059,-74.0833906,-74.0834865,-74.0833792,-74.0640309,-74.0638982,-74.0639298,-74.0641165,-74.0641403,-74.0640237,-74.0639993,-74.0637501,-74.0640473,-74.0649407,-74.0892496,-74.0896747,-74.0484363,-74.0486707,-74.0486587,-74.0483636,-74.0476268,-74.0641883,-74.0640993,-74.0640831,-74.168649,-74.0640278,-74.063731,-74.0635953,-74.0634379,-74.0634759,-74.0636422,-74.0648875,-74.0650896,-74.101852,-74.0641598,-74.0641691,-74.0639668,-74.0639574,-74.0641467,-74.0640796,-74.1444513,-74.1443242,-74.1443751,-74.143888,-74.1438637,-74.1439505,-74.1445022,-74.1439748,-74.2186337,-74.2186488,-74.2186823,-74.2183482,-74.2183985,-74.2183027,-74.2182523,-74.1093371,-74.1781662,-74.0972721,-74.132004,-74.0557975,-74.0550029,-74.0554615,-74.0559607,-74.114186,-74.1148176,-74.1150102,-74.1141787,-74.0678468,-74.067899,-74.0679246,-74.0680815,-74.0661438,-74.0473453,-74.1068437,-74.1068073,-74.1067716,-74.1067398,-74.1065626,-74.1065192,-74.1063685,-74.1064036,-74.1065696,-74.1065985,-74.1066356,-74.1066703,-74.1020294,-74.0669832,-74.0669297,-74.066779,-74.066712,-74.0650634,-74.0651231,-74.1009113,-74.0678253,-74.0667969,-74.0663848,-74.0682511,-74.068296,-74.0682594,-74.0682105,-74.0666192,-74.0662738,-74.0662396,-74.0662401,-74.0662255,-74.0666293,-74.0666782,-74.0667187,-74.0667107,-74.1492788,-74.0797764,-74.1780345,-74.1775197,-74.1776233,-74.1772944,-74.0650934,-74.1126313,-74.1127118,-74.1127333,-74.1127386,-74.1127279,-74.1500111,-74.2116614,-74.0660971,-74.0658841,-74.0984288,-74.0980336,-74.0983468,-74.214965,-74.0662324,-74.0660659,-74.0660878,-74.1308981,-74.0641752,-74.1156894,-74.0781012,-74.0481552,-74.1459997,-74.1466888,-74.0465742,-74.0473038,-74.0476125,-74.1076323,-74.1428969,-74.1430203,-74.0296486,-74.0471778,-74.0469635,-74.0470385,-74.0472529,-74.0858735,-74.0623567,-74.0753896,-74.1165651,-74.0650668,-74.055124,-74.1379878,-74.1386809,-74.138675,-74.138587,-74.138593,-74.1384803,-74.1384773,-74.138418,-74.1384308,-74.1383597,-74.1383537,-74.1382984,-74.1382371,-74.1381728,-74.1381105,-74.1381698,-74.1380987,-74.1380443,-74.1380384,-74.1379761,-74.13798,-74.1379049,-74.1379217,-74.1378565,-74.1377789,-74.1375978,-74.1375139,-74.0643743,-74.2119668,-74.1483757,-74.0682329,-74.0695796,-74.0967347,-74.097003,-74.0969257,-74.1438831,-74.076576,-74.0759712,-74.0702458,-74.0388267,-74.0773575,-74.0909493,-74.0600059,-74.0703501,-74.0721577,-74.0717122,-74.070234,-74.074871,-74.0691103,-74.0695374,-74.073565,-74.0673879,-74.074102,-74.0588794,-74.0691113,-74.0665979,-74.0635093,-74.0597374,-74.0694152,-74.0698032,-74.069113,-74.0687756,-74.0694193,-74.0257837,-74.0256389,-74.0257236,-74.0257814,-74.0257257,-74.0256611,-74.0717039,-74.0221258,-74.0666608,-74.0666422,-74.0666911,-74.0667098,-74.0666781,-74.0371627,-74.0370861,-74.0464548,-74.0637121,-74.0606765,-74.0700517,-74.0604732,-74.0687528,-74.0321326,-74.0321587,-74.0482736,-74.0904789,-74.1262796,-74.1263027,-74.1263412,-74.0916354,-74.0697782,-74.0698791,-74.0693325,-74.1145492,-74.0698646,-74.1244603,-74.1243732,-74.1245126,-74.1244287,-74.1242262,-74.1241473,-74.1241939,-74.1241113,-74.0307279,-74.0698059,-74.165676,-74.1251761,-74.1029711,-74.1027344,-74.1027922,-74.1097234,-74.1035323,-74.1934722,-74.1211941,-74.1240674,-74.1937926,-74.0727671,-74.0721598,-74.073817,-74.1388972,-74.1390036,-74.1389721,-74.1388554,-74.0812304,-74.0812662,-74.0812087,-74.0811728,-74.081128,-74.0811153,-74.0811016,-74.0810781,-74.0811247,-74.0811609,-74.0785978,-74.0543422,-74.0543857,-74.054397,-74.0544417,-74.0550522,-74.0549759,-74.0549339,-74.0780996,-74.0781975,-74.0782638,-74.0781659,-74.0776108,-74.0553379,-74.0951806,-74.0956494,-74.098545,-74.0968813,-74.0682205,-74.0683047,-74.1173914,-74.069528,-74.1061762,-74.1050956,-74.105045,-74.1051245,-74.105175,-74.0822616,-74.0562312,-74.1128244,-74.105104,-74.1050383,-74.1051453,-74.105211,-74.0926319,-74.029322,-74.0966283,-74.0966995,-74.0996179,-74.101026,-74.0558815,-74.0557853,-74.0557758,-74.0558721,-74.1037756,-74.0945408,-74.1001191,-74.0978635,-74.0987518,-74.0692127,-74.1001486,-74.1050311,-74.1049417,-74.1048836,-74.1049731,-74.0448269,-74.0560561,-74.0542472,-74.157203,-74.1066616,-74.1149304,-74.1041316,-74.1023909,-74.0298869,-74.0298921,-74.0298601,-74.0298549,-74.0993688,-74.0275532,-74.0646382,-74.1017746,-74.10171,-74.1017874,-74.063612,-74.0658632,-74.0641345,-74.0885159,-74.0884669,-74.08849,-74.088539,-74.0631052,-74.0625206,-74.0809452,-74.0633081,-74.0681524,-74.0682592,-74.0843277,-74.1260292,-74.0765461,-74.1245882,-74.0322147,-74.0321862,-74.1320859,-74.1171775,-74.1170852,-74.1159724,-74.1154845,-74.1155664,-74.115323,-74.1150547,-74.1147615,-74.1165673,-74.1179042,-74.1178412,-74.1177826,-74.1178445,-74.1316502,-74.1315902,-74.1315451,-74.1316051,-74.1210873,-74.1177072,-74.1177561,-74.1178375,-74.1177886,-74.118223,-74.0686543,-74.0683605,-74.0687282,-74.0862381,-74.0982608,-74.0720188,-74.1072652,-74.0536374,-74.0980812,-74.075049,-74.0751597,-74.0745427,-74.0744123,-74.1132156,-74.0611539,-74.108374,-74.0862345,-74.0899573,-74.0762341,-74.0839218,-74.090624,-74.0906446,-74.0906688,-74.0906866,-74.0906494,-74.0857215,-74.0972619,-74.1035466,-74.0954091,-74.0953628,-74.0953021,-74.0953484,-74.0835833,-74.0877272,-74.087659,-74.0876581,-74.0877263,-74.1028595,-74.1004482,-74.1004161,-74.1004458,-74.1004779,-74.0985612,-74.0986134,-74.0986023,-74.0985799,-74.0984808,-74.0985183,-74.0984599,-74.0984224,-74.0996763,-74.1000686,-74.0970146,-74.0620936,-74.0933697,-74.0970356,-74.0513332,-74.1071848,-74.1072214,-74.1072909,-74.1072543,-74.1388756,-74.0974794,-74.1052464,-74.1051741,-74.104535,-74.1045568,-74.1045982,-74.104628,-74.1183809,-74.1183319,-74.1181755,-74.1182245,-74.1233984,-74.1174845,-74.1133421,-74.1373116,-74.1353295,-74.1354744,-74.1354,-74.1352551,-74.1224288,-74.1355154,-74.1354534,-74.1354094,-74.1354713,-74.1335585,-74.1335033,-74.1335082,-74.1335635,-74.1325624,-74.1327738,-74.1328404,-74.1329817,-74.1329151,-74.1354451,-74.1355892,-74.1356458,-74.1360765,-74.1361173,-74.1359273,-74.135965,-74.136164,-74.1362762,-74.1361047,-74.1363344,-74.1361668,-74.1363772,-74.1362096,-74.1309911,-74.1308434,-74.1308364,-74.1309841,-74.1173443,-74.1186105,-74.1187615,-74.1124466,-74.1376977,-74.1377059,-74.137996,-74.1376455,-74.1145842,-74.1374952,-74.1375012,-74.1375071,-74.1132134,-74.1120421,-74.1006559,-74.1327863,-74.1327524,-74.1326801,-74.1326982,-74.1327291,-74.1386972,-74.1483006,-74.1604656,-74.1385337,-74.0586927,-74.1345721,-74.050429,-74.126094,-74.2085217,-74.2130119,-74.113457,-74.0567403,-74.0705904,-74.0707069,-74.0491237,-74.0308315,-74.0903386,-74.0705186,-74.0830984,-74.0216172,-74.021455,-74.0214325,-74.021612,-74.0542094,-74.0706732,-74.0439333,-74.0462314,-74.2122257,-74.2122046,-74.0699959,-74.1073982,-74.0710331,-74.0703935,-74.0712324,-74.0720418,-74.0606415,-74.0731506,-74.0712562,-74.0818214,-74.0728893,-74.0720899,-74.0828318,-74.0834768,-74.2137249,-74.091023,-74.0918003,-74.1062392,-74.0916442,-74.2121347,-74.2121137,-74.0650887,-74.0537716,-74.0624196,-74.062497,-74.0627245,-74.0775714,-74.0723141,-74.0725168,-74.0660804,-74.1108258,-74.1107456,-74.1106337,-74.1107122,-74.0768237,-74.0680577,-74.0733887,-74.073403,-74.0487066,-74.0710746,-74.0709526,-74.0709726,-74.0710988,-74.0709729,-74.0709529,-74.0710284,-74.0702261,-74.0701281,-74.0702406,-74.0701278,-74.0701103,-74.0701327,-74.0522727,-74.052691,-74.0663215,-74.1425378,-74.1424223,-74.1423886,-74.142504,-74.1424999,-74.1425278,-74.1425111,-74.1424821,-74.0617428,-74.1446681,-74.1446076,-74.1446235,-74.1446986,-74.1446472,-74.1446158,-74.0897956,-74.0693542,-74.1298723,-74.0651244,-74.0663709,-74.0544088,-74.0720903,-74.0761189,-74.0487904,-74.0481259,-74.0981565,-74.0981299,-74.0981216,-74.0980984,-74.0980735,-74.098047,-74.0978793,-74.0979706,-74.0979076,-74.0979889,-74.098037,-74.0980967,-74.0981432,-74.0980403,-74.1297619,-74.0989436,-74.1684454,-74.0569181,-74.0850294,-74.1326678,-74.087292,-74.1238301,-74.1250814,-74.1246023,-74.1857388,-74.1740129,-74.186565,-74.1870576,-74.1865468,-74.2225731,-74.1900134,-74.1898299,-74.1853918,-74.2127351,-74.2119419,-74.1694226,-74.2129546,-74.2130638,-74.1813085,-74.2143719,-74.2192035,-74.219313,-74.2186094,-74.2170747,-74.1796293,-74.1788116,-74.1787272,-74.1785315,-74.2132636,-74.1813784,-74.1797817,-74.1794588,-74.0672961,-74.0565248,-74.0297266,-74.0771366,-74.0441593,-74.0569384,-74.061705],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"green","weight":1,"opacity":0.5,"fill":true,"fillColor":"green","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[4.5020772,4.8191459],"lng":[-74.2225731,-74.0128579]}},"evals":[],"jsHooks":[]}</script>


---
# The earth ain't flat


&lt;img src="figures/world-1.png" width="800" style="display: block; margin: auto;" /&gt;


---
# The earth ain't flat


&lt;img src="figures/Mercator.png" width="800" style="display: block; margin: auto;" /&gt;

---
# Which projection should I choose?



- “There exist no all-purpose projections, all involve distortion when far from the center of the specified frame” (Bivand, Pebesma, and Gómez-Rubio 2013)

  -  Geographic coordinate systems: coordinate systems that span the entire globe (e.g. latitude / longitude).
  
  - Projected coordinate systems: coordinate systems that are localized to minimize visual distortion in a particular region (e.g. Robinson, UTM, State Plane)

---
# Which projection should I choose?
  
  - In some cases, it is not something that we are free to decide: “often the choice of projection is made by a public mapping agency” (Bivand, Pebesma, and Gómez-Rubio 2013).

  -  This means that when working with local data sources, it is likely preferable to work with the CRS in which the data was provided.

  - For Bogotá the IGAC promotes the adoption of MAGNA-SIRGAS. EPSG code: 4626


---
# Creating Objects

.pull-left[

```r
db&lt;-data.frame(place=c("Uniandes","Banco de La Republica"),lat=c(4.601590,4.602151), 
               long=c(-74.066391,-74.072350), 
               nudge_y=c(-0.001,0.001))

db&lt;-db %&gt;% mutate(latp=lat,longp=long)

db&lt;-st_as_sf(db,coords=c('longp','latp'),
             crs=4326)



ggplot()+
  geom_sf(data=upla %&gt;% filter(UPlNombre%in%c("LA CANDELARIA","LAS NIEVES")), fill = NA) +
  geom_sf(data=db, col="red") +
  geom_label(data = db, aes(x = long, y = lat, label = place), 
        size = 3, col = "black", fontface = "bold", nudge_y =db$nudge_y) +
  theme_bw() +
  theme(axis.title =element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size=6))
```
]

.pull-right[
![](Lecture1_files/figure-html/plot-label-out-1.png)&lt;!-- --&gt;
]

---
# Projections


```r
st_distance(db)
```

```
## Units: [m]
##          [,1]     [,2]
## [1,]   0.0000 663.4148
## [2,] 663.4148   0.0000
```
&lt;img src="figures/distance_google_maps.png" width="400" height="300" style="display: block; margin: auto;" /&gt;
---
# Projections


```r
st_distance(db,ciclovias)
```

---
# Projections


```r
st_crs(ciclovias)
```

```
## Coordinate Reference System:
##   User input: WGS 84 / Pseudo-Mercator 
##   wkt:
## PROJCRS["WGS 84 / Pseudo-Mercator",
##     BASEGEOGCRS["WGS 84",
##         ENSEMBLE["World Geodetic System 1984 ensemble",
##             MEMBER["World Geodetic System 1984 (Transit)"],
##             MEMBER["World Geodetic System 1984 (G730)"],
##             MEMBER["World Geodetic System 1984 (G873)"],
##             MEMBER["World Geodetic System 1984 (G1150)"],
##             MEMBER["World Geodetic System 1984 (G1674)"],
##             MEMBER["World Geodetic System 1984 (G1762)"],
##             MEMBER["World Geodetic System 1984 (G2139)"],
##             ELLIPSOID["WGS 84",6378137,298.257223563,
##                 LENGTHUNIT["metre",1]],
##             ENSEMBLEACCURACY[2.0]],
##         PRIMEM["Greenwich",0,
##             ANGLEUNIT["degree",0.0174532925199433]],
##         ID["EPSG",4326]],
##     CONVERSION["Popular Visualisation Pseudo-Mercator",
##         METHOD["Popular Visualisation Pseudo Mercator",
##             ID["EPSG",1024]],
##         PARAMETER["Latitude of natural origin",0,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8801]],
##         PARAMETER["Longitude of natural origin",0,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8802]],
##         PARAMETER["False easting",0,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8806]],
##         PARAMETER["False northing",0,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8807]]],
##     CS[Cartesian,2],
##         AXIS["easting (X)",east,
##             ORDER[1],
##             LENGTHUNIT["metre",1]],
##         AXIS["northing (Y)",north,
##             ORDER[2],
##             LENGTHUNIT["metre",1]],
##     USAGE[
##         SCOPE["Web mapping and visualisation."],
##         AREA["World between 85.06°S and 85.06°N."],
##         BBOX[-85.06,-180,85.06,180]],
##     ID["EPSG",3857]]
```

---
# Projections

```r
ciclovias&lt;-st_transform(ciclovias, 4686)
st_crs(ciclovias)
```

```
## Coordinate Reference System:
##   User input: EPSG:4686 
##   wkt:
## GEOGCRS["MAGNA-SIRGAS",
##     DATUM["Marco Geocentrico Nacional de Referencia",
##         ELLIPSOID["GRS 1980",6378137,298.257222101,
##             LENGTHUNIT["metre",1]]],
##     PRIMEM["Greenwich",0,
##         ANGLEUNIT["degree",0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS["geodetic latitude (Lat)",north,
##             ORDER[1],
##             ANGLEUNIT["degree",0.0174532925199433]],
##         AXIS["geodetic longitude (Lon)",east,
##             ORDER[2],
##             ANGLEUNIT["degree",0.0174532925199433]],
##     USAGE[
##         SCOPE["Horizontal component of 3D system."],
##         AREA["Colombia - onshore and offshore. Includes San Andres y Providencia, Malpelo Islands, Roncador Bank, Serrana Bank and Serranilla Bank."],
##         BBOX[-4.23,-84.77,15.51,-66.87]],
##     ID["EPSG",4686]]
```


---
# Projections


```r
db&lt;-st_transform(db, 4686)
st_distance(db,ciclovias)
```

```
## Units: [m]
##          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
## [1,] 9558.043 10849.15 6067.123 12919.99 6056.803 8305.854 4584.280 741.6373
## [2,] 9266.684 10745.60 6174.203 13067.09 5893.809 7650.594 4021.339 116.5990
##           [,9]    [,10]    [,11]    [,12]    [,13]    [,14]
## [1,] 1007.9356 6276.167 2398.351 8393.236 8665.629 3798.107
## [2,]  985.6333 5861.552 2437.682 7730.152 8039.042 3449.191
```

---
# Projections
.pull-left[

```r
ggplot()+
  geom_sf(data=ciclovias[8,], fill = NA) +
  geom_sf(data=db, col="red") +
  theme_bw() +
  theme(axis.title =element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_text(size=6))
```
]

.pull-right[
![](Lecture1_files/figure-html/ciclovias-1.png)&lt;!-- --&gt;
]
---
class: center, middle


#  Point Process Methods
---
#  Questions

- Are the points spread uniformly over the survey region? 

- Are the points randomly scattered? 

- Is there evidence of clustering? 

- Does the density of points depend on an explanatory variable? 

--

To give a sensible answer we must recognise that these questions are not about the points themselves, but about the way the points were generated.
---

&lt;img src="figures/point_realizations.png" width="900" height="600" style="display: block; margin: auto;" /&gt;
---
# Complete spatial randomness (CSR)

Properties:

- homogeneity

- independence

---
# Simulation of CSR


```r
require("spatstat")
```

```
## Loading required package: spatstat
```

```
## Loading required package: spatstat.data
```

```
## Loading required package: spatstat.geom
```

```
## spatstat.geom 2.4-0
```

```
## 
## Attaching package: 'spatstat.geom'
```

```
## The following object is masked from 'package:scales':
## 
##     rescale
```

```
## Loading required package: spatstat.random
```

```
## spatstat.random 2.2-0
```

```
## Loading required package: spatstat.core
```

```
## Loading required package: nlme
```

```
## 
## Attaching package: 'nlme'
```

```
## The following object is masked from 'package:dplyr':
## 
##     collapse
```

```
## Loading required package: rpart
```

```
## spatstat.core 2.4-4
```

```
## Loading required package: spatstat.linnet
```

```
## spatstat.linnet 2.3-2
```

```
## 
## spatstat 2.3-4       (nickname: 'Watch this space') 
## For an introduction to spatstat, type 'beginner'
```


---
class: center
# Simulation of CSR


```r
set.seed(10101)
plot(rpoispp(50))
```

![](Lecture1_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;


---
class: center
# Simulation of CSR


```r
plot(rpoispp(100,nsim=6))
```

![](Lecture1_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;
---
# Inhomogeneous Poisson process

Properties:

- intensity function
- independence
- Poisson-distributed counts

---
# Simulation Inhomogeneous Poisson process
.pull-left[

```r
lambda &lt;- function(x,y) { 100 * (x^2+y) } 
X &lt;- rpoispp(lambda, win=square(1))
```
]
.pull-right[

```r
plot(X)
```

![](Lecture1_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;
]
---
# Estimating Homogeneous Intensity



```r
npoints(swedishpines)/area(Window(swedishpines))
```

```
## [1] 0.007395833
```


```r
intensity(swedishpines)
```

```
## [1] 0.007395833
```


```r
unitname(swedishpines)
```

```
## 0.1 metres
```

---
# Estimating Homogeneous Intensity


```r
summary(swedishpines)
```

```
## Planar point pattern:  71 points
## Average intensity 0.007395833 points per square unit (one unit = 0.1 metres)
## 
## Coordinates are integers
## i.e. rounded to the nearest unit (one unit = 0.1 metres)
## 
## Window: rectangle = [0, 96] x [0, 100] units
## Window area = 9600 square units
## Unit of length: 0.1 metres
```


---
# Estimating Homogeneous Intensity



```r
intensity(rescale(swedishpines))
```

```
## [1] 0.7395833
```

---
# Estimating Homogeneous Intensity


```r
X &lt;- rescale(swedishpines)
lam &lt;- intensity(X)
(sdX &lt;- sqrt(lam/area(Window(X))))
```

```
## [1] 0.08777239
```

---
# Quadrant Counting



```r
swp &lt;- rescale(swedishpines)
Q3 &lt;- quadratcount(swp, nx=3, ny=3)
Q3
```

```
##              x
## y             [0,3.2) [3.2,6.4) [6.4,9.6]
##   [6.67,10]         8         6         7
##   [3.33,6.67)       8        11         9
##   [0,3.33)          5         6        11
```

---
# Quadrant Counting


![](Lecture1_files/figure-html/unnamed-chunk-38-1.png)&lt;!-- --&gt;


---
# Quadrant Counting test for homogeneity


```r
intensity(Q3)
```

```
##              x
## y             [0,3.2) [3.2,6.4) [6.4,9.6]
##   [6.67,10]   0.75000   0.56250   0.65625
##   [3.33,6.67) 0.75000   1.03125   0.84375
##   [0,3.33)    0.46875   0.56250   1.03125
```

---
# Quadrant Counting test for homogeneity


```r
tS &lt;- quadrat.test(swp, 3,3)
tS
```

```
## 
## 	Chi-squared test of CSR using quadrat counts
## 
## data:  swp
## X2 = 4.6761, df = 8, p-value = 0.4169
## alternative hypothesis: two.sided
## 
## Quadrats: 3 by 3 grid of tiles
```


```r
tS$p.value
```

```
## [1] 0.4168565
```

---
# Quadrant Counting test for homogeneity
![](Lecture1_files/figure-html/unnamed-chunk-42-1.png)&lt;!-- --&gt;

---


```r
sessionInfo()
```

```
## R version 4.2.0 (2022-04-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur/Monterey 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] spatstat_2.3-4        spatstat.linnet_2.3-2 spatstat.core_2.4-4  
##  [4] rpart_4.1.16          nlme_3.1-157          spatstat.random_2.2-0
##  [7] spatstat.geom_2.4-0   spatstat.data_2.2-0   osmdata_0.1.10       
## [10] leaflet_2.1.1         here_1.0.1            sf_1.0-7             
## [13] scales_1.2.0          plotly_4.10.0         lubridate_1.8.0      
## [16] nomnoml_0.2.5         knitr_1.39            forcats_0.5.1        
## [19] stringr_1.4.0         dplyr_1.0.9           purrr_0.3.4          
## [22] readr_2.1.2           tidyr_1.2.0           tibble_3.1.7         
## [25] ggplot2_3.3.6         tidyverse_1.3.1       xaringanExtra_0.6.0  
## [28] xaringanthemer_0.4.1 
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_2.0-3      selectr_0.4-2         deldir_1.0-6         
##  [4] ellipsis_0.3.2        class_7.3-20          rprojroot_2.0.3      
##  [7] fs_1.5.2              rstudioapi_0.13       proxy_0.4-26         
## [10] farver_2.1.0          xaringan_0.25         fansi_1.0.3          
## [13] xml2_1.3.3            splines_4.2.0         codetools_0.2-18     
## [16] polyclip_1.10-0       jsonlite_1.8.0        broom_0.8.0          
## [19] dbplyr_2.2.0          png_0.1-7             spatstat.sparse_2.1-1
## [22] compiler_4.2.0        httr_1.4.3            backports_1.4.1      
## [25] assertthat_0.2.1      Matrix_1.4-1          fastmap_1.1.0        
## [28] lazyeval_0.2.2        cli_3.3.0             s2_1.0.7             
## [31] htmltools_0.5.2       tools_4.2.0           gtable_0.3.0         
## [34] glue_1.6.2            wk_0.6.0              rappdirs_0.3.3       
## [37] Rcpp_1.0.8.3          cellranger_1.1.0      jquerylib_0.1.4      
## [40] vctrs_0.4.1           crosstalk_1.2.0       xfun_0.31            
## [43] rvest_1.0.2           lifecycle_1.0.1       goftest_1.2-3        
## [46] hms_1.1.1             spatstat.utils_2.3-1  httr2_0.2.1          
## [49] yaml_2.3.5            curl_4.3.2            sass_0.4.1           
## [52] stringi_1.7.6         highr_0.9             e1071_1.7-11         
## [55] rlang_1.0.2           pkgconfig_2.0.3       evaluate_0.15        
## [58] lattice_0.20-45       tensor_1.5            htmlwidgets_1.5.4    
## [61] labeling_0.4.2        tidyselect_1.1.2      magrittr_2.0.3       
## [64] R6_2.5.1              generics_0.1.2        DBI_1.1.2            
## [67] mgcv_1.8-40           pillar_1.7.0          haven_2.5.0          
## [70] whisker_0.4           withr_2.5.0           units_0.8-0          
## [73] abind_1.4-5           sp_1.5-0              modelr_0.1.8         
## [76] crayon_1.5.1          KernSmooth_2.23-20    utf8_1.2.2           
## [79] tzdb_0.3.0            rmarkdown_2.14        grid_4.2.0           
## [82] readxl_1.4.0          data.table_1.14.2     reprex_2.0.1         
## [85] digest_0.6.29         classInt_0.4-3        webshot_0.5.3        
## [88] munsell_0.5.0         viridisLite_0.4.0     bslib_0.3.1
```

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"ratio": "191:100",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
